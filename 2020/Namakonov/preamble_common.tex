% %\usepackage[style=authoryear,backend=biber]{biblatex}

% %\usepackage{cite}
% \usepackage{booktabs}
% \usepackage{subcaption}
% \usepackage{microtype}
% \usepackage{amsmath}
% \usepackage{amssymb,amsfonts,amsthm}
% \usepackage{stmaryrd}
% \usepackage{multicol}
% \usepackage{algorithm}
% \usepackage[noend]{algpseudocode}
% \usepackage{graphicx}
% \usepackage{tikz}
% \usepackage{thm-restate}
% \usepackage{mathpartir}
% \usepackage{xspace}

% \usepackage{authblk}
% \usepackage{listings}
% %% \usepackage[dvipsnames]{xcolor}
% \usepackage{colortbl}
% \usepackage{hyperref}
% \usepackage[capitalise]{cleveref}
% % \usepackage[utf8]{inputenc}
% % usepackage[russian]{babel}

% % custom

% \usepackage[shortlabels]{enumitem}
% \setlist[enumerate, 1]{1)}

% \usepackage{cmap}

% %% \usepackage{microtype}%if unwanted, comment out or use option "draft"
% \usepackage{thmtools,thm-restate}
% \usepackage{semantic}
% \usepackage{chngcntr}

% \renewcommand*{\Authsep}{, }
% \renewcommand*{\Authand}{, }
% \renewcommand*{\Authands}{, }

% \newcommand{\valuefail}[1]{\textcolor{red!60!black}{// #1}}
% \newcolumntype{L}{>{$}l<{$}} % math-mode version of "l" column type

% \declaretheorem[name=Теорема,style=default,numberwithin=section]{thm}
% \declaretheorem[name=Лемма,style=default,numberwithin=section]{lem}
% \declaretheorem[name=Определение,style=default,sibling=thm]{mydefinition}
%\declaretheorem[name=Определение,style=definition,numbered=no]{mydefinition}


\newcommand{\valuecom}[1]{\textcolor{green!60!black}{/\!/ #1}}
\newcommand{\textdom}[1]{\mathsf{#1}}
\newcommand{\textcode}[1]{\texorpdfstring{\texttt{#1}}{#1}}
\newcommand{\kw}[1]{\textbf{\textcode{#1}}}
\newcommand{\skipc}{\kw{skip}}
\newcommand{\ite}[3]{\kw{if}\;#1\:\kw{then}\;#2\;\\ \kw{else}\;#3}
\newcommand{\iteml}[3]{
  \kw{if} \; #1\\
  \begin{array}[t]{@{}l@{}l}
    \kw{then}& \begin{array}[t]{l} #2 \end{array} \\
    \kw{else}& \begin{array}[t]{l} #3 \end{array} \\
  \end{array}
}
\newcommand{\itne}[2]{\kw{if}\;#1\:\kw{then}\\ \quad\;{#2}}
\newcommand{\while}[2]{\kw{while}\;#1\;\kw{do}\;#2}
\newcommand{\ALT}{\;\;|\;\;}

\newcommand{\ie}{\emph{i.e.,} }
\newcommand{\eg}{\emph{e.g.,} }
\newcommand{\etal}{\emph{et~al.}}
\newcommand{\wrt}{w.r.t.~}


\newcommand{\set}[1]{\{{#1}\}}
\newcommand{\sem}[1]{\llbracket #1 \rrbracket}
\newcommand{\pfn}{\rightharpoonup}
\newcommand{\st}{\; | \;}
\newcommand{\N}{{\mathbb{N}}}
\newcommand{\dom}[1]{\textit{dom}{({#1})}}
\newcommand{\codom}[1]{\textit{codom}{({#1})}}
\newcommand{\before}[2]{{#1}_{#2}^\uparrow}
\newcommand{\after}[2]{{#1}_{#2}^\downarrow}
%\newcommand{\fv}[1]{fv{[{#1}]}}
\newcommand{\tup}[1]{{\langle{#1}\rangle}}
\newcommand{\nin}{\not\in}
\newcommand{\suq}{\subseteq}
\newcommand{\sqsuq}{\sqsubseteq}
\newcommand{\sqsu}{\sqsubset}
\newcommand{\sqslq}{\sqsupseteq}
\newcommand{\size}[1]{|{#1}|}
\newcommand{\true}{\top}
\newcommand{\maketil}[1]{{#1}\ldots{#1}}
\newcommand{\til}{\maketil{,}}
\newcommand{\cuptil}{\maketil{\cup}}
\newcommand{\uplustil}{\maketil{\uplus}}
\renewcommand*{\mathellipsis}{\mathinner{{\ldotp}{\ldotp}{\ldotp}}}
\newcommand{\rst}[1]{|_{#1}}
\newcommand{\imm}[1]{{#1}{\rst{\text{imm}}}}
\renewcommand{\succ}[2]{\text{succ}_{#1}(#2)}
\newcommand{\aite}[3]{(#1?#2,#3)}
%\newcommand{\defeq}{\mathrel{\stackrel{\mathsf{def}}{=}}}
\newcommand{\defeq}{\triangleq}
\newcommand{\powerset}[1]{\mathcal{P}({#1})}
\newcommand{\finpowerset}[1]{\mathcal{P}_{<\omega}({#1})}
\renewcommand{\implies}{\Rightarrow}


\colorlet{colorPO}{gray!60!black}
\colorlet{colorRF}{green!60!black}
\colorlet{colorMO}{orange}
\colorlet{colorFR}{purple}
\colorlet{colorECO}{red!80!black}
\colorlet{colorSYN}{green!40!black}
\colorlet{colorHB}{blue}
\colorlet{colorPPO}{magenta}
\colorlet{colorPB}{olive}
\colorlet{colorSBRF}{olive}
\colorlet{colorRMW}{olive!70!black}
\colorlet{colorRSEQ}{blue}
\colorlet{colorSC}{violet}
\colorlet{colorPSC}{violet}
\colorlet{colorREL}{olive}
\colorlet{colorCONFLICT}{olive}
\colorlet{colorRACE}{olive}
\colorlet{colorWB}{orange!70!black}
\colorlet{colorPSC}{violet}
\colorlet{colorSCB}{violet}
\colorlet{colorDEPS}{violet}
\colorlet{colorAR}{black}

\tikzset{
   every path/.style={>=stealth},
   po/.style={->,color=colorPO,thin,shorten >=-0.5mm,shorten <=-0.5mm},
   sw/.style={->,color=colorSYN,shorten >=-0.5mm,shorten <=-0.5mm},
   rf/.style={->,color=colorRF,dashed,,shorten >=-0.5mm,shorten <=-0.5mm},
   hb/.style={->,color=colorHB,thick,shorten >=-0.5mm,shorten <=-0.5mm},
   co/.style={->,color=colorMO,dotted,very thick,shorten >=-0.5mm,shorten <=-0.5mm},
   no/.style={->,dotted,thick,shorten >=-0.5mm,shorten <=-0.5mm},
   fr/.style={->,color=colorFR,dotted,thick,shorten >=-0.5mm,shorten <=-0.5mm},
   deps/.style={->,color=colorDEPS,dotted,thick,shorten >=-0.5mm,shorten <=-0.5mm},
   rmw/.style={->,color=colorRMW,thick,shorten >=-0.5mm,shorten <=-0.5mm},
   pngexport/.style={
     external/system call/.add=
     {}
     {; convert -density 300 -transparent white "\image.pdf" "\image.png"},
     % 
     /pgf/images/external info,
     /pgf/images/include external/.code={%
       \includegraphics
       [width=\pgfexternalwidth,height=\pgfexternalheight]
       {##1.png}%
     },
   }
 }
\newcommand{\dpo}[2]{\draw[po] (#1) edge (#2)}
\newcommand{\dpopo}[2]{\draw[po] (#1) edge node[right] {$\lPO$} (#2)}
\newcommand{\drmw}[2]{\draw[rmw, bend right=20] (#1) edge node[left] {$\lRMW$} (#2)}
\newcommand{\dco}[2]{\draw[co] (#1) edge node[right] {$\lCO$} (#2)}
\newcommand{\dcoext}[4]{\draw[co, #3] (#1) edge node[#4] {$\lCO$} (#2)}
\newcommand{\drf}[2]{\draw[rf] (#1) edge node[left] {$\lRF$} (#2)}
\newcommand{\dfr}[3]{\draw[fr, #3] (#1) edge node[left] {$\lFR$}(#2)}
\newcommand{\dhb}[3]{\draw[hb, #3] (#1) edge node[right] {$\lHB$} (#2)}


%% Orders
\newcommand{\pln}{\mathtt{pln}}
\newcommand{\rlx}{\mathtt{rlx}}
\newcommand{\rel}{{\mathtt{rel}}}
\newcommand{\acq}{{\mathtt{acq}}}
\newcommand{\acqrel}{{\mathtt{acqrel}}}
\newcommand{\sco}{{\mathtt{sc}}}
\newcommand{\sto}{{\mathtt{st}}}
\newcommand{\full}{{\mathtt{sy}}}
\newcommand{\ld}{{\mathtt{ld}}}
\newcommand{\isb}{{\mathtt{isb}}}

% omm modes
\newcommand{\na}{{\mathtt{na}}}
\newcommand{\at}{{\mathtt{at}}}

%% Event labels

\newcommand{\evlab}[4]{{#1}({#3},{#4})}
\newcommand{\evflab}[1]{{\flab}^{#1}}
\newcommand{\evulab}[4]{{\ulab}^{#1}({#2},{#3},{#4})}
\newcommand{\rlab}[3]{{\lR}^{#1}({#2},{#3})}
\newcommand{\erlab}[4]{{\lR}^{#1}({#2},{#3},{#4})}
\newcommand{\wlab}[3]{{\lW}^{#1}({#2},{#3})}
\newcommand{\flab}[1]{{\lF}(#1)}
%\newcommand{\ulab}[4]{{\lU}^{#1}({#2},{#3},{#4})}

\newcommand{\lE}{{\mathtt{E}}}
\newcommand{\lC}{{\mathtt{C}}}
%\newcommand{\lP}{{\mathit{P}}}
\newcommand{\lM}{{\mathtt{M}}}
\newcommand{\lS}{{\mathtt{S}}}
\newcommand{\lR}{{\mathtt{R}}}
\newcommand{\lW}{{\mathtt{W}}}
\newcommand{\lA}{{\mathtt{A}}}
\newcommand{\lQ}{{\mathtt{Q}}}
\newcommand{\lL}{{\mathtt{L}}}
\newcommand{\lU}{{\mathtt{RMW}}}
\newcommand{\lF}{{\mathtt{F}}}
\newcommand{\lRES}{{\mathtt{Res}}}
\newcommand{\lAT}{{\mathtt{At}}}
\newcommand{\lATR}{{\mathtt{AtR}}}

\newcommand{\lLAB}{{\mathtt{lab}}}
\newcommand{\lTID}{{\mathtt{tid}}}
\newcommand{\lTYP}{{\mathtt{typ}}}
\newcommand{\lLOC}{{\mathtt{loc}}}
\newcommand{\lMOD}{{\mathtt{mod}}}
\newcommand{\lVALR}{{\mathtt{val_r}}}
\newcommand{\lVALW}{{\mathtt{val_w}}}
\newcommand{\lELAB}{{\mathtt{elab}}}
\newcommand{\lAVALS}{{\mathtt{atvals}}}

%% Relations

\newcommand{\lX}{\mathtt{X}}
\newcommand{\lPO}{{\color{colorPO}\mathtt{po}}}
\newcommand{\lRF}{{\color{colorRF} \mathtt{rf}}}
\newcommand{\lRMW}{{\color{colorRMW} \mathtt{rmw}}}
\newcommand{\lMO}{{\color{colorMO} \mathtt{mo}}}
\newcommand{\lMOx}{{\color{colorMO} \mathtt{mo}}_x}
\newcommand{\lMOy}{{\color{colorMO} \mathtt{mo}}_y}
\newcommand{\lCO}{{\color{colorMO} \mathtt{co}}}
\newcommand{\lCOx}{{\color{colorMO} \mathtt{co}}_x}
\newcommand{\lCOy}{{\color{colorMO} \mathtt{co}}_y}
\newcommand{\lFR}{{\color{colorFR} \mathtt{fr}}}
\newcommand{\lFRx}{{\color{colorFR} \mathtt{rb}}_x}
\newcommand{\lFRy}{{\color{colorFR} \mathtt{rb}}_y}
\newcommand{\lECO}{{\color{colorECO} \mathtt{eco}}}
\newcommand{\lSBRF}{{\color{colorSBRF} \mathtt{sbrf}}}
\newcommand{\lRSEQ}{{\color{colorRSEQ}\mathtt{rseq}}}
\newcommand{\lSW}{{\color{colorSYN}\mathtt{sw}}}
\newcommand{\lHB}{{\color{colorHB}\mathtt{hb}}}
\newcommand{\lHBO}{{\color{olive}\mathtt{hbo}}}
%\newcommand{\lWB}{{\color{colorWB} \mathtt{wb}}}
\newcommand{\lDOB}{{\mathtt{dob}}}
\newcommand{\lBOB}{{\mathtt{bob}}}
\newcommand{\lAOB}{{\mathtt{aob}}}
\newcommand{\lOBS}{{\mathtt{obs}}}
\newcommand{\lEORD}{{\mathtt{eord}}}
\newcommand{\lTORD}{{\mathtt{tord}}}
\newcommand{\lSC}{{\mathtt{sc}}}
\newcommand{\lAR}{{\color{colorAR} \mathtt{ar}}}

\newcommand{\lSCB}{{\color{colorSCB} \mathtt{scb}}}
\newcommand{\lPSC}{{\color{colorPSC} \mathtt{psc}}}
\newcommand{\lPSCB}{\lPSC_{\rm base}}
\newcommand{\lPSCF}{\lPSC_\lF}
\newcommand{\lCONFLICT}{{\color{colorCONFLICT} \mathtt{conflict}}}
\newcommand{\lRACE}{{\color{colorRACE} \mathtt{race}}}
\newcommand{\lNARACE}{{\color{colorRACE} \mathtt{na-race}}}

\newcommand{\lmakeW}[1]{\mathtt{w}#1}
\newcommand{\lWFR}{\lmakeW{\lFR}}
\newcommand{\lWECO}{\lmakeW{\lECO}}
\newcommand{\lWSCB}{\lmakeW{\lSCB}}
\newcommand{\lWPSCB}{\lmakeW{\lPSCB}}
\newcommand{\lWPSCF}{\lmakeW{\lPSCF}}
\newcommand{\lWPSC}{\lmakeW{\lPSC}}
\newcommand{\lWB}{\lmakeW{\lMO}}

\newcommand{\lDEPS}{{{\color{colorDEPS}\mathtt{deps}}}}
\newcommand{\lCTRL}{{{\color{colorDEPS}\mathtt{ctrl}}}}
\newcommand{\lCTRLISYNC}{{{\color{colorDEPS}\mathtt{ctrl_{isync}}}}}
\newcommand{\lDATA}{{{\color{colorDEPS}\mathtt{data}}}}
\newcommand{\lADDR}{{{\color{colorDEPS}\mathtt{addr}}}}
\newcommand{\lCASDEP}{{{\color{colorDEPS}\mathtt{casdep}}}}

\newcommand{\lmakeE}[1]{#1\mathtt{e}}
\newcommand{\lRFE}{\lmakeE{\lRF}}
\newcommand{\lCOE}{\lmakeE{\lCO}}
\newcommand{\lFRE}{\lmakeE{\lFR}}
\newcommand{\lMOE}{\lmakeE{\lMO}}
\newcommand{\lmakeI}[1]{#1\mathtt{i}}
\newcommand{\lRFI}{\lmakeI{\lRF}}
\newcommand{\lCOI}{\lmakeI{\lCO}}
\newcommand{\lFRI}{\lmakeI{\lFR}}

\newcommand{\Tid}{\mathsf{Tid}}
\newcommand{\Loc}{\mathsf{Loc}}
\newcommand{\Val}{\mathsf{Val}}
\newcommand{\Init}{\mathsf{Init}}
\newcommand{\Lab}{\mathsf{Lab}}
\newcommand{\Mod}{\mathsf{Mod}}
\newcommand{\Modr}{\mathsf{Mod}_{\lR}}
\newcommand{\Modw}{\mathsf{Mod}_{\lW}}
\newcommand{\Modf}{\mathsf{Mod}_{\lF}}
\newcommand{\Modrmw}{\mathsf{Mod}_{\lU}}


\newcommand{\stepa}{\leadsto_{\ARM}}
\newcommand{\stepp}{\promStepgen{}}
%% \leadsto_{\Promise}}
\newcommand{\stepptid}{\leadsto_{\Promise \; tid}}
\newcommand{\lISB}{\mathtt{F^{\isb}}}
\newcommand{\lDMB}{\mathtt{DMB}}
\newcommand{\lDMBSY}{\flab{\SY}}
\newcommand{\lDMBLD}{\flab{\LD}}
\newcommand{\lDMBST}{\flab{\ST}}
\newcommand{\SY}{\mathtt{sy}}
\newcommand{\LD}{\mathtt{ld}}
\newcommand{\ST}{\mathtt{st}}
\newcommand{\removeCR}[1]{\mathsf{RemoveCR}({#1})}
%% \spnewtheorem{defn}{Definition}{\bfseries}{}
%% \crefname{defn}{Definition}{Definitions}
\newcommand{\Timestamp}{\mathtt{Time}}
\newcommand{\TimestampMap}{\mathit{TimeMap}}

\newcommand{\Prog}{\ensuremath{Prog}\xspace}
\newcommand{\ProgARM}{\ensuremath{Prog_\ARM}\xspace}

\newcounter{mylabelcounter}

\makeatletter
\newcommand{\labelAxiom}[2]{%
\hfill{\normalfont\textsc{(#1)}}\refstepcounter{mylabelcounter}
\immediate\write\@auxout{%
  %% \string\newlabel{#2}{{1}{\thepage}{{#1}}{mylabelcounter.\number\value{mylabelcounter}}{}}
  \string\newlabel{#2}{{\unexpanded{\normalfont\textsc{#1}}}{\thepage}{{\unexpanded{\normalfont\textsc{#1}}}}{mylabelcounter.\number\value{mylabelcounter}}{}}
}%
}
\makeatother


% example rels
\newcommand{\exX}{\mathtt{x}}
\newcommand{\exY}{\mathtt{y}}

\makeatletter
\providecommand{\@thefnmark}{\the\@fnmark}
\makeatother

\makeatletter
\makeatother

\definecolor{StringRed}{rgb}{.637,0.082,0.082}
\definecolor{CommentGreen}{rgb}{0.0,0.55,0.3}
\definecolor{KeywordBlue}{rgb}{0.0,0.3,0.55}
\definecolor{LinkColor}{rgb}{0.55,0.0,0.3}
\definecolor{CiteColor}{rgb}{0.55,0.0,0.3}
\definecolor{HighlightColor}{rgb}{0.0,0.0,0.0}


\definecolor{grey}{rgb}{0.5,0.5,0.5}
\definecolor{red}{rgb}{1,0,0}
\definecolor{darkgreen}{rgb}{0.0,0.7,0.0}

\hypersetup{%
  linktocpage=true, pdfstartview=FitV,
  breaklinks=true, pageanchor=true, pdfpagemode=UseOutlines,
  plainpages=false, bookmarksnumbered, bookmarksopen=true, bookmarksopenlevel=3,
  hypertexnames=true, pdfhighlight=/O,
  colorlinks=true,linkcolor=LinkColor,citecolor=CiteColor,
  urlcolor=LinkColor
}


%\newcommand{\TODO}[1]{\emph{\color{red} \textbf{TODO: #1}}}

\crefformat{section}{#2\S{}#1#3}
\Crefname{section}{Раздел}{Разделы}
\Crefformat{section}{Section #2#1#3}

\Crefname{figure}{\text{рис.}}{\text{рис.}}
\Crefname{table}{\text{таб.}}{\text{таб.}}
\crefname{corollary}{\text{Corollary}}{\text{corollaries}}
\Crefname{corollary}{\text{Corollary}}{\text{Corollaries}}
\crefname{lemma}{\text{Lemma}}{\text{Lemmas}}
\Crefname{lemma}{\text{Lemma}}{\text{Lemmas}}
\crefname{theorem}{\text{Theorem}}{\text{Theorems}}
\Crefname{theorem}{\text{Theorem}}{\text{Theorems}}
\crefname{proposition}{\text{Prop.}}{\text{Propositions}}
\Crefname{proposition}{\text{Proposition}}{\text{Propositions}}
\crefname{definition}{\text{Опр.}}{\text{Опр.}}
\Crefname{definition}{\text{Опр.}}{\text{Опр.}}

\newcommand{\setof}[1]{\{\, #1 \,\}}
\newcommand{\setofz}[1]{\{ #1 \}}
\newcommand{\suchthat}{\;|\;}
\newcommand{\txtsub}[2]{{#1}_{\text{#2}}}

\newcommand{\relo}{{\texttt{rel}}}
\newcommand{\acqo}{{\texttt{acq}}}
\newcommand{\ra}{\texttt{ra}}
\newcommand{\AVal}{{\textdom{G}}}

\newcommand{\step}{\longrightarrow}
\newcommand{\astep}[1]{\xrightarrow{#1}}
\newcommand{\bstep}[1]{\xRightarrow{#1}}
\newcommand{\cstep}[2]{\xrightarrow[{#1}]{{#2}}}
\newcommand{\dstep}[2]{\dhxrightarrow[{#1}]{{#2}}}
\newcommand{\Pfin}{\txtsub{P}{final}}
\newcommand{\fin}{\text{final}}
\newcommand{\rulename}[1]{{\textsc{({#1})}}}
\newcommand{\onestep}[2]{{\textsc{({#1}}{({#2})}\textsc{)}}}

\newcommand{\Einit}{{\texttt{E}_{\texttt{init}}}}
\newcommand{\SBinit}{{\texttt{SB}_{\texttt{init}}}}

\newcommand{\LOC}{\mathit{loc}}

%% blue, brown, cyan, darkgray, gray, green, lime, magenta, olive, orange, pink, purple, red, teal, violet, yellow.

\newcommand{\lcur}{{\texttt{cur}}}
\newcommand{\lrel}{{\texttt{rel}}}
\newcommand{\lacq}{{\texttt{acq}}}
\newcommand{\srlx}{{\texttt{srlx}}}
\newcommand{\lacqrel}{{\texttt{acqrel}}}
\newcommand{\lsco}{{\texttt{sc}}}
\newcommand{\lscmo}{{\texttt{sf}}}
\newcommand{\lread}{{\texttt{rd}}}
\newcommand{\lwrite}{{\texttt{wr}}}
\newcommand{\lrw}{{\texttt{rlx}}}
\newcommand{\lur}{{\texttt{pln}}}
\newcommand{\lall}{\ast}
\newcommand{\lrdwr}{\setofz{\lread,\lwrite}}
\newcommand{\lval}{{\texttt{val}}}
\newcommand{\lfrom}{{\texttt{from}}}
\newcommand{\lto}{{\texttt{to}}}
\newcommand{\ltime}{{\texttt{t}}}

\hypersetup{%
  linktocpage=true, pdfstartview=FitV,
  breaklinks=true, pageanchor=true, pdfpagemode=UseOutlines,
  plainpages=false, bookmarksnumbered, bookmarksopen=true, bookmarksopenlevel=3,
  hypertexnames=true, pdfhighlight=/O,
}


\newcommand{\compile}[1]{{\llparenthesis{#1}\rrparenthesis}}


\newcommand{\commentNonempty}[1]{
  \ifx\\#1\\
    {}
  \else
    \valuecom{#1}
  \fi
  }
\newcommand{\readInst}[4]{#1 \;:=\;[#2]^{#4}; \commentNonempty{#3}}
\newcommand{\fenceInst}[1]{\mathtt{fence}^{#1};}
\newcommand{\writeInst}[3]{[#1]^{#3}\;:=\;#2;}
\newcommand{\casInstSC}[3]{\mathtt{CAS^{\sco, \sco}_{\sco}(#1, #2, #3)};}
\newcommand{\assignInst}[2]{#1\;:=\;#2;}
\newcommand{\exchangeInstSC}[2]{\mathtt{exchange^{\sco}(#1, #2)};}
\newcommand{\term}[1]{\emph{#1}}

%\bibliographystyle{apalike}
